<view class="page">
  <view class="quote-container">
    <view class="page-header">
      <text class="page-title">报价明细</text>
      <text class="page-subtitle">QUOTATION DETAILS</text>
    </view>
    <view class="category-section" wx:for="{{quoteDetail.pricingItems}}" wx:for-item="category" wx:key="name">
      <view class="category-card">
        <view class="category-header">
          <text class="category-title">{{category.name}}</text>
          <view wx:if="{{category.computeData && category.computeData.amount != null}}" class="category-subtotal-pill">
            <text class="subtotal-pill-label">小计</text>
            <text class="subtotal-pill-value">¥{{category.computeData.amount}}</text>
          </view>
        </view>
        <view class="category-items">
          <view class="service-row" wx:for="{{category.items}}" wx:for-item="service" wx:key="name">
            <view class="service-main">
              <text class="service-title">{{service.name}}</text>
              <view class="service-meta">
                <text class="service-meta-text">{{service.quantity}}{{service.unit}}</text>
                <text class="service-meta-dot">·</text>
                <text wx:if="{{service.deliveryPeriodDays <= 0}}" class="service-meta-text">
                  周期待定
                </text>
                <text wx:else class="service-meta-text">{{service.deliveryPeriodDays}} 天</text>
              </view>
            </view>
            <view class="service-unit">
              <text class="service-unit-label">单价</text>
              <text class="service-unit-value">¥{{service.unitPrice}}</text>
            </view>
            <view class="service-amount">
              <text class="service-unit-label">周期</text>
              <text wx:if="{{service.deliveryPeriodDays <= 0}}" class="service-unit-value">待定</text>
              <text wx:else class="service-unit-value">{{service.deliveryPeriodDays}} 天</text>
            </view>
          </view>
        </view>
      </view>
    </view>
    <view wx:if="{{payNodesWithAmount.length}}" class="section-card">
      <view class="section-header">
        <text class="section-title">付款计划</text>
      </view>
      <view class="payment-timeline">
        <view class="payment-item" wx:for="{{payNodesWithAmount}}" wx:for-item="node" wx:for-index="index" wx:key="nodeName">
          <view class="payment-left">
            <view class="payment-bullet-wrapper">
              <view class="payment-line" wx:if="{{index !== 0}}"></view>
              <view class="payment-bullet"></view>
              <view class="payment-line payment-line-bottom" wx:if="{{index !== payNodesWithAmount.length - 1}}"></view>
            </view>
            <view class="payment-text">
              <text class="payment-name">{{node.nodeName}}</text>
              <view class="payment-meta">
                <text class="payment-meta-text">{{node.nodeRatio * 100}}%</text>
                <text class="payment-meta-dot">·</text>
                <text wx:if="{{node.nodeDate}}" class="payment-meta-text">{{node.nodeDate}}</text>
                <text wx:else class="payment-meta-text">时间待定</text>
              </view>
            </view>
          </view>
          <view class="payment-right">
            <text class="payment-amount">¥{{node.amount}}</text>
          </view>
        </view>
      </view>
    </view>
    <view wx:if="{{quoteDetail.serviceTerms}}" class="section-card">
      <view class="section-header">
        <text class="section-title">备注</text>
      </view>
      <view class="remark-body">
        <text class="remark-text">{{quoteDetail.serviceTerms}}</text>
      </view>
    </view>
    <view wx:if="{{totalAmount}}" class="summary-card">
      <view class="summary-row">
        <text class="summary-label">项目分项小计</text>
        <text class="summary-value">¥{{totalAmountDisplay}}</text>
      </view>
      <view wx:if="{{discountAmount > 0}}" class="summary-row">
        <text class="summary-label">优惠减免</text>
        <text class="summary-discount">-¥{{discountAmountDisplay}}</text>
      </view>
      <view class="summary-divider"></view>
      <view class="summary-total-row">
        <view class="summary-total-text">
          <text class="summary-total-label">总计</text>
        </view>
        <text class="summary-total-amount">¥{{finalTotalAmountDisplay}}</text>
      </view>
    </view>
  </view>
</view>