<view>
  <view class="service-category" wx:for="{{pricingItems}}" wx:for-item="category" wx:for-index="categoryIndex" wx:key="name">
    <view class="service-category-header flex" bindtap="onToggleCategoryCollapseTap" data-category-index="{{categoryIndex}}">
      <view class="service-summary">
        <view class="service-title">{{category.name}}</view>
        <view class="service-meta">
          <text>{{category.items && category.items.length || 0}} 个服务项</text>
        </view>
      </view>
      <view class="service-actions">
        <view class="service-action" catchtap="onDeleteCategoryTap" data-category-index="{{categoryIndex}}">
          <span class="icon--delete-16-regular icon-size-15 icon-color-error"></span>
        </view>
      </view>
    </view>
    <view class="config-schema-row {{categoryCollapseStatus[categoryIndex] ? 'config-schema-row--collapsed' : 'config-schema-row--expanded'}}">
      <view class="ml-lg mr-lg mb-lg">
        <view class="service-field">
          <view class="service-field-label">服务组标题</view>
          <input class="config-input" placeholder="服务组标题" value="{{category.name}}" data-category-index="{{categoryIndex}}" bindblur="onCategoryNameBlur" />
        </view>
        <view class="service-group-divider"></view>
        <view class="service-list-box service-list-box-{{categoryIndex}}">
          <view wx:if="{{showDragServiceOverlay && dragServiceCategoryIndex === categoryIndex}}" class="config-schema-pill service-drag-ghost" style="top: {{dragServiceOverlayTop}}px">
            <view class="service-header flex">
              <view class="service-summary">
                <view class="service-title">{{dragServiceSnapshot.name}}</view>
                <view class="service-meta">
                  <text>¥{{dragServiceSnapshot.unitPrice}}/{{dragServiceSnapshot.unit}}</text>
                  <text>x{{dragServiceSnapshot.quantity}}</text>
                  <text class="service-meta-separator">·</text>
                  <text>{{dragServiceSnapshot.deliveryPeriodDays}}天</text>
                </view>
              </view>
            </view>
          </view>
          <view class="service-item" wx:for="{{category.items}}" wx:for-item="service" wx:for-index="serviceIndex" wx:key="name">
            <span class="icon--move-y-circle icon-size-15" style="color:gray;width:15px" catchtouchstart="onDragStart" catchtouchmove="onDragMove" catchtouchend="onDragEnd" data-category-index="{{categoryIndex}}" data-service-index="{{serviceIndex}}"></span>
            <view class="config-schema-pill {{serviceCollapseStatus[categoryIndex] && serviceCollapseStatus[categoryIndex][serviceIndex] ? 'config-schema-pill--collapsed' : 'config-schema-pill--expanded'}}">
              <view class="service-header flex" bindtap="onToggleCollapseTap" data-category-index="{{categoryIndex}}" data-service-index="{{serviceIndex}}">
                <view class="service-summary">
                  <view class="service-title">{{service.name}}</view>
                  <view class="service-meta">
                    <text>¥{{service.unitPrice}}元/{{service.unit}}</text>
                    <text class="service-meta-separator">·</text>
                    <text>x{{service.quantity}}</text>
                    <text class="service-meta-separator">·</text>
                    <text wx:if="{{service.deliveryPeriodDays <= 0}}">待定</text>
                    <text wx:else>{{service.deliveryPeriodDays}}天</text>
                  </view>
                </view>
                <span class="icon--delete-16-regular icon-size-15 icon-color-error" catchtap="onDeleteTap" data-category-index="{{categoryIndex}}" data-service-index="{{serviceIndex}}"></span>
              </view>
              <view class="service-body {{serviceCollapseStatus[categoryIndex] && serviceCollapseStatus[categoryIndex][serviceIndex] ? 'service-body--collapsed' : 'service-body--expanded'}}">
                <view class="ml-lg mb-lg mr-lg">
                  <view class="service-field">
                    <view class="service-field-label">项目名称</view>
                    <input class="config-input" placeholder="项目名称" value="{{service.name}}" data-field="name" data-category-index="{{categoryIndex}}" data-service-index="{{serviceIndex}}" bindblur="onFieldBlur" />
                  </view>
                  <view class="service-field-grid">
                    <view class="service-field-item">
                      <view class="service-field-label">单价(元)</view>
                      <input class="config-input-small" type="digit" placeholder="单价" value="{{service.unitPrice}}" data-field="unitPrice" data-category-index="{{categoryIndex}}" data-service-index="{{serviceIndex}}" bindblur="onFieldBlur" />
                    </view>
                    <view class="service-field-item">
                      <view class="service-field-label">单位</view>
                      <input class="config-input-small" placeholder="单位" value="{{service.unit}}" data-field="unit" data-category-index="{{categoryIndex}}" data-service-index="{{serviceIndex}}" bindblur="onFieldBlur" />
                    </view>
                    <view class="service-field-item">
                      <view class="service-field-label">数量</view>
                      <input class="config-input-small" type="number" placeholder="数量" value="{{service.quantity}}" data-field="quantity" data-category-index="{{categoryIndex}}" data-service-index="{{serviceIndex}}" bindblur="onFieldBlur" />
                    </view>
                    <view class="service-field-item">
                      <view class="service-field-label">周期(天)</view>
                      <input class="config-input-small" type="number" placeholder="周期(天)" value="{{service.deliveryPeriodDays}}" data-field="deliveryPeriodDays" data-category-index="{{categoryIndex}}" data-service-index="{{serviceIndex}}" bindblur="onFieldBlur" />
                    </view>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>
        <view class="config-schema-action" bindtap="onAddServiceTap" data-category-index="{{categoryIndex}}">
          ＋ 添加服务项
        </view>
      </view>
    </view>
  </view>
  <view class="config-schema-footer" bindtap="onAddCategoryTap">＋ 增加服务类别</view>
</view>