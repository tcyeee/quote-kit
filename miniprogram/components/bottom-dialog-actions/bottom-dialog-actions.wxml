<view class="bottom-dialog-body">
  <scroll-view class="bottom-dialog-scroll" scroll-y="true" enhanced="{{true}}" show-scrollbar="{{false}}">
    <view class="action-bar">
      <button class="action-btn secondary" bindtap="onSaveImageTap">保存为图片</button>
      <button class="action-btn primary" open-type="share">发送报价单</button>
    </view>
    <!-- 配置项:主题选择 -->
    <view class="config-schema-section">
      <view class="config-schema-header" bindtap="onToggleSection" data-section="theme">
        <view class="config-schema-title">主题选择</view>
        <text class="config-schema-arrow">{{CollapseStatus.theme ? '展开' : '收起'}}</text>
      </view>
      <view wx:if="{{!CollapseStatus.theme}}">
        <view class="theme-options">
          <view class="theme-option {{quoteDetail.theme === 'amber' ? 'active' : ''}}" data-theme="amber" bindtap="onThemeTap">
            <image class="theme-bg" src="../../assets/button_1.png" mode="aspectFill"></image>
            <view class="theme-overlay"></view>
            <text class="theme-name">月光</text>
          </view>
          <view class="theme-option {{quoteDetail.theme === 'neon' ? 'active' : ''}}" data-theme="neon" bindtap="onThemeTap">
            <image class="theme-bg" src="../../assets/button_2.png" mode="aspectFill"></image>
            <view class="theme-overlay"></view>
            <text class="theme-name">深海</text>
          </view>
          <view class="theme-option {{quoteDetail.theme === 'moonlight' ? 'active' : ''}}" data-theme="moonlight" bindtap="onThemeTap">
            <image class="theme-bg" src="../../assets/button_3.png" mode="aspectFill"></image>
            <view class="theme-overlay"></view>
            <text class="theme-name">琥珀</text>
          </view>
          <view class="theme-option {{quoteDetail.theme === 'deep-sea' ? 'active' : ''}}" data-theme="deep-sea" bindtap="onThemeTap">
            <image class="theme-bg" src="../../assets/button_4.png" mode="aspectFill"></image>
            <view class="theme-overlay"></view>
            <text class="theme-name">霓虹</text>
          </view>
        </view>
      </view>
    </view>
    <!-- 配置项:我的公司信息 -->
    <view class="config-schema-section">
      <view class="config-schema-header" bindtap="onToggleSection" data-section="company">
        <view class="config-schema-title">我的公司信息</view>
        <text class="config-schema-arrow">{{CollapseStatus.company ? '展开' : '收起'}}</text>
      </view>
      <view wx:if="{{!CollapseStatus.company}}">
        <view class="config-schema-group">
          <input class="config-schema-pill" placeholder="我的公司名称(可选)" value="{{quoteDetail.domain.name}}" bindinput="onDomainNameInput" bindblur="onDomainNameBlur" />
          <view class="config-schema-pill">我的公司LOGO(可选)</view>
        </view>
      </view>
    </view>
    <!-- 配置项:服务内容 -->
    <view class="config-schema-section">
      <view class="config-schema-header" bindtap="onToggleSection" data-section="service">
        <view class="config-schema-title">服务内容</view>
        <text class="config-schema-arrow">{{CollapseStatus.service ? '展开' : '收起'}}</text>
      </view>
      <view wx:if="{{!CollapseStatus.service}}">
        <view class="config-schema-group">
          <view wx:for="{{quoteDetail.pricingItems}}" wx:for-item="category" wx:for-index="categoryIndex" wx:key="name">
            <view class="config-schema-label">{{category.name}}</view>
            <view class="config-schema-row">
              <view class="service-list-box service-list-box-{{categoryIndex}}">
                <view wx:if="{{showDragServiceOverlay && dragServiceCategoryIndex === categoryIndex}}" class="config-schema-pill service-drag-ghost" style="top: {{dragServiceOverlayTop}}px">
                  <view class="service-header flex">
                    <view class="service-summary">
                      <view class="service-title">{{dragServiceSnapshot.name}}</view>
                      <view class="service-meta">
                        <text>¥{{dragServiceSnapshot.unitPrice}}/{{dragServiceSnapshot.unit}}</text>
                        <text>x{{dragServiceSnapshot.quantity}}</text>
                        <text class="service-meta-separator">·</text>
                        <text>{{dragServiceSnapshot.deliveryPeriodDays}}天</text>
                      </view>
                    </view>
                  </view>
                </view>
                <!-- 服务项目 -->
                <view wx:for="{{category.items}}" wx:for-item="service" wx:for-index="serviceIndex" wx:key="name" class="config-schema-pill">
                  <view class="service-header flex">
                    <view class="service-summary">
                      <view class="service-title">{{service.name}}</view>
                      <view class="service-meta">
                        <text>¥{{service.unitPrice}}/{{service.unit}}</text>
                        <text class="service-meta-separator">·</text>
                        <text>x{{service.quantity}}</text>
                        <text class="service-meta-separator">·</text>
                        <text wx:if="{{service.deliveryPeriodDays <= 0}}">待定</text>
                        <text wx:else>{{service.deliveryPeriodDays}}天</text>
                      </view>
                    </view>
                    <view class="service-actions">
                      <span class="icon--delete-16-regular icon-size-24 icon-color-error" data-category-index="{{categoryIndex}}" data-service-index="{{serviceIndex}}" bindtap="onDeleteService"></span>
                      <span class="icon--move-y-circle icon-size-24" data-category-index="{{categoryIndex}}" data-service-index="{{serviceIndex}}" catchtouchstart="onServiceDragStart" catchtouchmove="onServiceDragMove" catchtouchend="onServiceDragEnd"></span>
                      <span class="icon--circle-chevron-up icon-size-24 service-collapse-icon {{serviceCollapseStatus[categoryIndex] && serviceCollapseStatus[categoryIndex][serviceIndex] ? '' : 'service-collapse-icon--collapsed'}}" data-category-index="{{categoryIndex}}" data-service-index="{{serviceIndex}}" bindtap="onToggleServiceCollapse"></span>
                    </view>
                  </view>
                  <view class="service-body {{serviceCollapseStatus[categoryIndex] && serviceCollapseStatus[categoryIndex][serviceIndex] ? 'service-body--collapsed' : 'service-body--expanded'}}">
                    <view class="service-field">
                      <view class="service-field-label">项目名称</view>
                      <input class="config-input" placeholder="项目名称" value="{{service.name}}" data-category-index="{{categoryIndex}}" data-service-index="{{serviceIndex}}" bindinput="onServiceNameInput" bindblur="onServiceFieldBlur" />
                    </view>
                    <view class="service-field-grid">
                      <view class="service-field-item">
                        <view class="service-field-label">单价</view>
                        <input class="config-input-small" type="digit" placeholder="单价" value="{{service.unitPrice}}" data-category-index="{{categoryIndex}}" data-service-index="{{serviceIndex}}" bindinput="onServiceUnitPriceInput" bindblur="onServiceFieldBlur" />
                      </view>
                      <view class="service-field-item">
                        <view class="service-field-label">单位</view>
                        <input class="config-input-small" placeholder="单位" value="{{service.unit}}" data-category-index="{{categoryIndex}}" data-service-index="{{serviceIndex}}" bindinput="onServiceUnitInput" bindblur="onServiceFieldBlur" />
                      </view>
                      <view class="service-field-item">
                        <view class="service-field-label">数量</view>
                        <input class="config-input-small" type="number" placeholder="数量" value="{{service.quantity}}" data-category-index="{{categoryIndex}}" data-service-index="{{serviceIndex}}" bindinput="onServiceQuantityInput" bindblur="onServiceFieldBlur" />
                      </view>
                      <view class="service-field-item">
                        <view class="service-field-label">周期(天)</view>
                        <input class="config-input-small" type="number" placeholder="周期(天)" value="{{service.deliveryPeriodDays}}" data-category-index="{{categoryIndex}}" data-service-index="{{serviceIndex}}" bindinput="onServiceDeliveryPeriodInput" bindblur="onServiceFieldBlur" />
                      </view>
                    </view>
                  </view>
                </view>
              </view>
              <view class="config-schema-pill config-schema-action">＋ 添加服务项</view>
            </view>
          </view>
        </view>
        <view class="config-schema-footer">＋ 增加服务类别</view>
      </view>
    </view>
    <!-- 配置项:付款比例设置 -->
    <view class="config-schema-section">
      <view class="config-schema-header" bindtap="onToggleSection" data-section="payment">
        <view class="config-schema-title">付款比例设置</view>
        <text class="config-schema-arrow">{{CollapseStatus.payment ? '展开' : '收起'}}</text>
      </view>
      <view wx:if="{{!CollapseStatus.payment}}">
        <view class="config-schema-group">
          <input class="config-schema-pill" type="digit" placeholder="定金比例(%)" value="{{quoteDetail.serviceProcess.depositRatio * 100}}" bindinput="onDepositRatioInput" bindblur="onDepositRatioBlur" />
          <input class="config-schema-pill" type="digit" placeholder="尾款比例(%)" value="{{quoteDetail.serviceProcess.finalPaymentRatio * 100}}" bindinput="onFinalPaymentRatioInput" bindblur="onFinalPaymentRatioBlur" />
          <view class="config-schema-pill config-schema-action">增加交付节点</view>
        </view>
      </view>
    </view>
    <!-- 底部备注信息 -->
    <view class="config-schema-section">
      <view class="config-schema-header" bindtap="onToggleSection" data-section="remark">
        <view class="config-schema-title">备注</view>
        <text class="config-schema-arrow">{{CollapseStatus.remark ? '展开' : '收起'}}</text>
      </view>
      <view wx:if="{{!CollapseStatus.remark}}">
        <view class="config-schema-group">
          <textarea class="config-textarea" placeholder="输入备注信息" value="{{quoteDetail.serviceTerms}}" bindinput="onServiceTermsInput" bindblur="onServiceTermsBlur" />
        </view>
      </view>
    </view>
    <view style="height: 10vh;"></view>
  </scroll-view>
</view>